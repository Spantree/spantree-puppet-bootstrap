{
  "variables": {
    "user_home": "{{ env `HOME` }}",
    "box_name": "ubuntu-trusty-64",
    "headless": "true",
    "build_number": 1,
    "version": "1.2.1",
    "project_dir": "/usr/local/src/spantree-puppet-bootstrap",
    "hostname": "puppetbootstrap.spantree.internal",

    "puppet_version": "{{env `PUPPET_VERSION`}}",

    "vbox_guest_additions_url": "http://dlc-cdn.sun.com/virtualbox/4.3.20/VBoxGuestAdditions_4.3.20.iso",
    "vbox_guest_additions_sha256": "9ab48f44ac26a6deb374cb5fe6bad103bbf4fdf5186140e2d40ebe48bd01f3ea",
    "box_ovf": "{{ env `HOME` }}/.vagrant.d/boxes/ubuntu-VAGRANTSLASH-trusty64/14.04/virtualbox/box.ovf"
  },
  "builders": [
    {
      "name": "virtualbox-ovf",
      "type": "virtualbox-ovf",
      "vm_name": "{{ user `box_name` }}-{{user `version`}}",

      "source_path": "{{ user `box_ovf` }}",

      "ssh_username": "vagrant",
      "ssh_password": "vagrant",
      "ssh_port": "22",
      "ssh_wait_timeout": "30s",

      "guest_additions_url": "{{ user `vbox_guest_additions_url` }}",
      "guest_additions_sha256": "{{ user `vbox_guest_additions_sha256` }}",
      "guest_additions_path": "VBoxGuestAdditions_{{.Version}}.iso",

      "headless": "{{user `headless`}}",

      "shutdown_command": "echo 'vagrant' | sudo -S shutdown -P now",

      "vboxmanage": [
        ["modifyvm", "{{.Name}}", "--memory", "1536"],
        ["modifyvm", "{{.Name}}", "--cpus", "2"]
      ]
    }
  ],
  "post-processors": [
    {
      "only": [
        "virtualbox-ovf"
      ],
      "output": "{{user `box_name`}}-{{user `version`}}-{{.Provider}}-puppet-{{ user `puppet_version` }}.box",
      "type": "vagrant"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "execute_command": "echo 'vagrant'|sudo -S bash '{{.Path}}'",
      "scripts": [
        "packer/install-vboxguest.sh"
      ],
      "only": ["virtualbox-ovf"]
    }
  ]
}
